(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,26201,t=>{"use strict";class e{context=null;stream=null;processor=null;callback=null;sampleRate;constructor(t=16e3){this.sampleRate=t}onAudioData(t){this.callback=t}async start(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.sampleRate,channelCount:1,echoCancellation:!0,noiseSuppression:!0}}),this.context=new AudioContext({sampleRate:this.sampleRate});let t=this.context.createMediaStreamSource(this.stream);this.processor=this.context.createScriptProcessor(4096,1,1),this.processor.onaudioprocess=t=>{let e=t.inputBuffer.getChannelData(0);this.callback?.(new Float32Array(e))},t.connect(this.processor),this.processor.connect(this.context.destination)}stop(){this.processor?.disconnect(),this.stream?.getTracks().forEach(t=>t.stop()),this.context?.close(),this.processor=null,this.stream=null,this.context=null}}class s{sampleRate;constructor(t=16e3){this.sampleRate=t}extract(t){return{mfcc:this.computeMFCC(t),energy:this.computeEnergy(t),pitch:this.estimatePitch(t),speechRate:this.estimateSpeechRate(t),pauseDuration:0}}computeMFCC(t){return new Float32Array(13)}computeEnergy(t){let e=0;for(let s=0;s<t.length;s++)e+=t[s]*t[s];return Math.sqrt(e/t.length)}estimatePitch(t){return this.sampleRate,0}estimateSpeechRate(t){return 0}}class i{speechThreshold;silenceThreshold;isSpeaking=!1;silenceStart=0;pauseHintMs;constructor(t=.5){this.speechThreshold=.015*(1-.8*t),this.silenceThreshold=.6*this.speechThreshold,this.pauseHintMs=800}classify(t){let{energy:e}=t,s=Date.now();if(!this.isSpeaking&&e>=this.speechThreshold)return this.isSpeaking=!0,this.silenceStart=0,{label:"speaking",confidence:this.energyToConfidence(e),timestamp:s};if(this.isSpeaking&&e>=this.silenceThreshold)return this.silenceStart=0,{label:"speaking",confidence:this.energyToConfidence(e),timestamp:s};if(this.isSpeaking&&e<this.silenceThreshold){0===this.silenceStart&&(this.silenceStart=s);let t=s-this.silenceStart;return t>=this.pauseHintMs?(this.isSpeaking=!1,{label:"turn_complete",confidence:Math.min(t/(2*this.pauseHintMs),1),timestamp:s}):{label:"thinking_pause",confidence:.6,timestamp:s}}return{label:"thinking_pause",confidence:.3,timestamp:s}}reset(){this.isSpeaking=!1,this.silenceStart=0}energyToConfidence(t){return Math.min(t/(4*this.speechThreshold),1)}}class a{session=null;fallback;constructor(t=.5){this.fallback=new i(t)}async load(t){this.session=null}async predict(t){return!this.session,this.fallback.classify(t)}dispose(){this.session=null,this.fallback.reset()}}class n{listeners=new Map;state="idle";pauseStart=0;speakStart=0;sensitivity;pauseTolerance;constructor(t=.5,e=1500){this.sensitivity=t,this.pauseTolerance=e}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){this.listeners.get(t)?.delete(e)}process(t){let{label:e,confidence:s,timestamp:i}=t,a=this.sensitivity;switch(e){case"speaking":"speaking"!==this.state&&(this.state="speaking",this.speakStart=i,this.emit("speechStart",{timestamp:i}));break;case"thinking_pause":"speaking"===this.state&&s>=a?(this.state="paused",this.pauseStart=i,this.emit("pause",{duration:0,confidence:s})):"paused"===this.state&&i-this.pauseStart>=this.pauseTolerance&&(this.state="idle",this.emit("turnEnd",{confidence:s,duration:i-this.speakStart}));break;case"turn_complete":("speaking"===this.state||"paused"===this.state)&&s>=a&&(this.state="idle",this.emit("turnEnd",{confidence:s,duration:i-this.speakStart}));break;case"interrupt_intent":s>=a&&this.emit("interrupt",{timestamp:i})}}reset(){this.state="idle",this.pauseStart=0,this.speakStart=0}emit(t,e){this.listeners.get(t)?.forEach(t=>t(e))}}let h={sensitivity:.5,pauseTolerance:1500,modelPath:"bundled",sampleRate:16e3};class r{options;audio;features;model;detector;listening=!1;constructor(t={}){this.options={...h,...t},this.audio=new e(this.options.sampleRate),this.features=new s(this.options.sampleRate),this.model=new a(this.options.sensitivity),this.detector=new n(this.options.sensitivity,this.options.pauseTolerance)}on(t,e){this.detector.on(t,e)}off(t,e){this.detector.off(t,e)}async start(){this.listening||(await this.model.load(this.options.modelPath),this.audio.onAudioData(async t=>{let e=this.features.extract(t),s=await this.model.predict(e);this.detector.process(s)}),await this.audio.start(),this.listening=!0)}stop(){this.listening&&(this.audio.stop(),this.model.dispose(),this.detector.reset(),this.listening=!1)}isListening(){return this.listening}}t.s(["Utterance",()=>r],26201)}]);